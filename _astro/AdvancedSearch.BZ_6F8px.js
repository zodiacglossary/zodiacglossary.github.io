import{j as e,L as B}from"./LemmaLink.2EoHCBTv.js";import{r as d}from"./index.Cd_vQiNd.js";const O={alphabetical:"original",alphabetical_transliteration:"transliteration",alphabetical_primary_meaning:"primary_meaning",zodiac:"primary_meaning",decans:"primary_meaning",planets_babylonian:"primary_meaning",planets_weekday:"primary_meaning",planets_heliocentric:"primary_meaning",planets_geocentric:"primary_meaning"},D={zodiac:["aries","taurus","gemini","cancer","leo","virgo","libra","scorpio","sagittarius","capricorn","aquarius","pisces"],planets_babylonian:["moon","sun","jupiter","venus","saturn","mercury","mars"],planets_weekday:["sun","moon","mars","mercury","jupiter","venus","saturn"],planets_heliocentric:["mercury","venus","earth","mars","jupiter","saturn","uranus","neptune"],planets_geocentric:["moon","mercury","venus","sun","mars","jupiter","saturn"],decans:Array.from({length:36},(o,j)=>`decan ${j+1}`)};function Q(o){return(j,c)=>{for(const g of o){const l=g(j,c);if(l!==0)return l}return 0}}function J(){const[o,j]=d.useState(null),[c,g]=d.useState([{field:"original",value:""}]),[l,v]=d.useState([{type:"alphabetical"}]),[_,q]=d.useState([]),[S,F]=d.useState(!0),[w,N]=d.useState(!0);d.useEffect(()=>{fetch("/data.json").then(a=>a.json()).then(a=>j(a))},[]);const P=()=>g([...c,{field:"original",value:""}]),T=a=>g(c.filter((s,n)=>n!==a)),V=(a,s)=>{const n=[...c];n[a].field=s,n[a].value="",g(n)},L=(a,s)=>{const n=[...c];n[a].value=s,g(n)},A=()=>v([...l,{type:"alphabetical"}]),I=a=>v(l.filter((s,n)=>n!==a)),M=(a,s)=>{const n=[...l];n[a].type=s,v(n)},z=async()=>{const a={lemmaIds:_.map(p=>p.lemma_id),includeSpellingVariants:S,includeQuotations:w,searchTerms:[],sortingCriteria:[]},n=await(await fetch("https://zodiac-glossary-pdf.fly.dev/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).blob(),b=URL.createObjectURL(n);window.open(b,"_blank")};return d.useEffect(()=>{if(!o)return;const{lemmata:a,meanings:s,meaningCategories:n,quotations:b}=o,p=new Map;s.forEach(t=>{p.has(t.lemma_id)||p.set(t.lemma_id,[]),p.get(t.lemma_id).push(t)});const m=new Map;b.forEach(t=>{m.has(t.lemma_id)||m.set(t.lemma_id,[]),m.get(t.lemma_id).push(t)});const k={editor:[],language:[],pos:[],literal_translation:[],meaning:[],category:[],original:[],transliteration:[],publication:[],provenance:[],source:[]};c.forEach(t=>{t.value.trim()!==""&&k[t.field].push(t)});const R=a.filter(t=>Object.entries(k).every(([y,h])=>h.length===0?!0:h.some(({value:f})=>{const r=f.toLowerCase().trim();switch(y){case"editor":return t.editor?.toLowerCase().includes(r);case"original":return t.original?.toLowerCase().includes(r);case"transliteration":return t.transliteration?.toLowerCase().includes(r);case"literal_translation":return t.translation?.toLowerCase().includes(r);case"language":return t.language_id===Number(r);case"pos":return t.partofspeech_id===Number(r);case"publication":return(m.get(t.lemma_id)||[]).some(i=>i.publication?.toLowerCase().includes(r));case"meaning":return(p.get(t.lemma_id)||[]).some(i=>i.value?.toLowerCase().includes(r));case"category":return(p.get(t.lemma_id)||[]).some(i=>n.find(x=>x.meaning_id===i.meaning_id)?.category?.toLowerCase()===r);case"provenance":return(m.get(t.lemma_id)||[]).some(i=>i.provenance?.toLowerCase().includes(r));case"source":return(m.get(t.lemma_id)||[]).some(i=>i.source?.toLowerCase().includes(r));default:return!0}})));if(l.length){const t=l.map(y=>{const h=O[y.type],f=D[y.type];return f?(r,u)=>{const i=(r[h]||"").toLowerCase(),E=(u[h]||"").toLowerCase(),x=f.indexOf(i),C=f.indexOf(E);return x!==-1&&C!==-1?x-C:x!==-1?-1:C!==-1?1:0}:(r,u)=>(r[h]||"").localeCompare(u[h]||"")});R.sort(Q(t))}q(R)},[c,o,l]),o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{class:"grid",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Search criteria"}),e.jsx("form",{className:"search-rows",children:c.map((a,s)=>e.jsxs("fieldset",{role:"group",children:[e.jsxs("select",{value:a.field,onChange:n=>V(s,n.target.value),children:[e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"language",children:"Language"}),e.jsx("option",{value:"pos",children:"Part of Speech"}),e.jsx("option",{value:"literal_translation",children:"Literal Translation"}),e.jsx("option",{value:"meaning",children:"Meaning"}),e.jsx("option",{value:"category",children:"Category"}),e.jsx("option",{value:"original",children:"Original"}),e.jsx("option",{value:"transliteration",children:"Transliteration"}),e.jsx("option",{value:"publication",children:"Publication"}),e.jsx("option",{value:"provenance",children:"Provenance"}),e.jsx("option",{value:"source",children:"Source"})]}),["language","pos","category"].includes(a.field)?e.jsxs("select",{value:a.value,onChange:n=>L(s,n.target.value),children:[e.jsx("option",{value:"",children:"—"}),a.field==="language"&&o.languages.map(n=>e.jsx("option",{value:n.language_id,children:n.label},n.language_id)),a.field==="category"&&[...new Set(o.meaningCategories.map(n=>n?.category))].toSorted().map(n=>e.jsx("option",{value:n,children:n},n)),a.field==="pos"&&o.partsofspeech.map(n=>e.jsx("option",{value:n.partofspeech_id,children:n.value},n.partofspeech_id))]}):e.jsx("input",{type:"text",value:a.value,onChange:n=>L(s,n.target.value),placeholder:"Enter search term…"}),e.jsx("button",{class:"secondary",onClick:()=>T(s),children:"✕"})]},s))}),e.jsx("button",{onClick:P,class:"secondary",children:"+ Add Search Condition"})]}),e.jsxs("div",{children:[e.jsx("h3",{children:"Sorting"}),e.jsxs("form",{className:"sort-rows",children:[l.map((a,s)=>e.jsxs("fieldset",{role:"group",children:[e.jsx("select",{value:a.type,onChange:n=>M(s,n.target.value),children:Object.keys(O).map(n=>e.jsx("option",{value:n,children:n},n))}),e.jsx("button",{class:"secondary",onClick:()=>I(s),children:"✕"})]},s)),e.jsx("button",{class:"secondary",onClick:A,children:"+ Add Sort Criterion"})]})]})]}),e.jsx("hr",{}),e.jsxs("div",{class:"grid",children:[e.jsx("button",{onClick:z,class:"secondary",children:"Generate PDF"}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",class:"secondary",checked:S,onChange:a=>F(a.target.checked)})," ","Include Spelling Variants"]})}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",class:"secondary",checked:w,onChange:a=>N(a.target.checked)})," ","Include Quotations"]})})]}),e.jsx("hr",{}),e.jsxs("article",{children:[e.jsxs("header",{children:["Results (",_.length,")"]}),e.jsx("ul",{className:"search-results",children:_.map(a=>e.jsx("li",{children:e.jsx(B,{lemma:a})},a.lemma_id))})]})]}):e.jsx("p",{"aria-busy":"true",children:"Loading…"})}export{J as default};
