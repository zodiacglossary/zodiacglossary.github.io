import{j as e,L as B}from"./LemmaLink.2EoHCBTv.js";import{r as m}from"./index.Cd_vQiNd.js";const R={alphabetical:"original",alphabetical_transliteration:"transliteration",alphabetical_primary_meaning:"primary_meaning",zodiac:"primary_meaning",decans:"primary_meaning",planets_babylonian:"primary_meaning",planets_weekday:"primary_meaning",planets_heliocentric:"primary_meaning",planets_geocentric:"primary_meaning"},P={zodiac:["aries","taurus","gemini","cancer","leo","virgo","libra","scorpio","sagittarius","capricorn","aquarius","pisces"],planets_babylonian:["moon","sun","jupiter","venus","saturn","mercury","mars"],planets_weekday:["sun","moon","mars","mercury","jupiter","venus","saturn"],planets_heliocentric:["mercury","venus","earth","mars","jupiter","saturn","uranus","neptune"],planets_geocentric:["moon","mercury","venus","sun","mars","jupiter","saturn"],decans:Array.from({length:36},(o,h)=>`decan ${h+1}`)};function T(o){return(h,c)=>{for(const p of o){const l=p(h,c);if(l!==0)return l}return 0}}function D(){const[o,h]=m.useState(null),[c,p]=m.useState([{field:"original",value:""}]),[l,_]=m.useState([{type:"alphabetical"}]),[b,E]=m.useState([]);m.useEffect(()=>{fetch("/data.json").then(n=>n.json()).then(n=>h(n))},[]);const k=()=>p([...c,{field:"original",value:""}]),q=n=>p(c.filter((r,a)=>a!==n)),A=(n,r)=>{const a=[...c];a[n].field=r,a[n].value="",p(a)},C=(n,r)=>{const a=[...c];a[n].value=r,p(a)},N=()=>_([...l,{type:"alphabetical"}]),O=n=>_(l.filter((r,a)=>a!==n)),F=(n,r)=>{const a=[...l];a[n].type=r,_(a)};return m.useEffect(()=>{if(!o)return;const{lemmata:n,meanings:r,meaningCategories:a,quotations:M}=o,f=new Map;r.forEach(t=>{f.has(t.lemma_id)||f.set(t.lemma_id,[]),f.get(t.lemma_id).push(t)});const g=new Map;M.forEach(t=>{g.has(t.lemma_id)||g.set(t.lemma_id,[]),g.get(t.lemma_id).push(t)});const L={editor:[],language:[],pos:[],literal_translation:[],meaning:[],category:[],original:[],transliteration:[],publication:[],provenance:[],source:[]};c.forEach(t=>{t.value.trim()!==""&&L[t.field].push(t)});const S=n.filter(t=>Object.entries(L).every(([x,d])=>d.length===0?!0:d.some(({value:j})=>{const s=j.toLowerCase().trim();switch(x){case"editor":return t.editor?.toLowerCase().includes(s);case"original":return t.original?.toLowerCase().includes(s);case"transliteration":return t.transliteration?.toLowerCase().includes(s);case"literal_translation":return t.translation?.toLowerCase().includes(s);case"language":return t.language_id===Number(s);case"pos":return t.partofspeech_id===Number(s);case"publication":return(g.get(t.lemma_id)||[]).some(i=>i.publication?.toLowerCase().includes(s));case"meaning":return(f.get(t.lemma_id)||[]).some(i=>i.value?.toLowerCase().includes(s));case"category":return(f.get(t.lemma_id)||[]).some(i=>a.find(v=>v.meaning_id===i.meaning_id)?.category?.toLowerCase()===s);case"provenance":return(g.get(t.lemma_id)||[]).some(i=>i.provenance?.toLowerCase().includes(s));case"source":return(g.get(t.lemma_id)||[]).some(i=>i.source?.toLowerCase().includes(s));default:return!0}})));if(l.length){const t=l.map(x=>{const d=R[x.type],j=P[x.type];return j?(s,u)=>{const i=(s[d]||"").toLowerCase(),w=(u[d]||"").toLowerCase(),v=j.indexOf(i),y=j.indexOf(w);return v!==-1&&y!==-1?v-y:v!==-1?-1:y!==-1?1:0}:(s,u)=>(s[d]||"").localeCompare(u[d]||"")});S.sort(T(t))}E(S)},[c,o,l]),o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{class:"grid",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Search criteria"}),e.jsx("form",{className:"search-rows",children:c.map((n,r)=>e.jsxs("fieldset",{role:"group",children:[e.jsxs("select",{value:n.field,onChange:a=>A(r,a.target.value),children:[e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"language",children:"Language"}),e.jsx("option",{value:"pos",children:"Part of Speech"}),e.jsx("option",{value:"literal_translation",children:"Literal Translation"}),e.jsx("option",{value:"meaning",children:"Meaning"}),e.jsx("option",{value:"category",children:"Category"}),e.jsx("option",{value:"original",children:"Original"}),e.jsx("option",{value:"transliteration",children:"Transliteration"}),e.jsx("option",{value:"publication",children:"Publication"}),e.jsx("option",{value:"provenance",children:"Provenance"}),e.jsx("option",{value:"source",children:"Source"})]}),["language","pos","category"].includes(n.field)?e.jsxs("select",{value:n.value,onChange:a=>C(r,a.target.value),children:[e.jsx("option",{value:"",children:"—"}),n.field==="language"&&o.languages.map(a=>e.jsx("option",{value:a.language_id,children:a.label},a.language_id)),n.field==="category"&&[...new Set(o.meaningCategories.map(a=>a?.category))].toSorted().map(a=>e.jsx("option",{value:a,children:a},a)),n.field==="pos"&&o.partsofspeech.map(a=>e.jsx("option",{value:a.partofspeech_id,children:a.value},a.partofspeech_id))]}):e.jsx("input",{type:"text",value:n.value,onChange:a=>C(r,a.target.value),placeholder:"Enter search term…"}),e.jsx("button",{class:"secondary",onClick:()=>q(r),children:"✕"})]},r))}),e.jsx("button",{onClick:k,class:"secondary",children:"+ Add Search Condition"})]}),e.jsxs("div",{children:[e.jsx("h3",{children:"Sorting"}),e.jsxs("form",{className:"sort-rows",children:[l.map((n,r)=>e.jsxs("fieldset",{role:"group",children:[e.jsx("select",{value:n.type,onChange:a=>F(r,a.target.value),children:Object.keys(R).map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("button",{class:"secondary",onClick:()=>O(r),children:"✕"})]},r)),e.jsx("button",{class:"secondary",onClick:N,children:"+ Add Sort Criterion"})]})]})]}),e.jsx("hr",{}),e.jsxs("article",{children:[e.jsxs("header",{children:["Results (",b.length,")"]}),e.jsx("ul",{className:"search-results",children:b.map(n=>e.jsx("li",{children:e.jsx(B,{lemma:n})},n.lemma_id))})]})]}):e.jsx("p",{"aria-busy":"true",children:"Loading…"})}export{D as default};
