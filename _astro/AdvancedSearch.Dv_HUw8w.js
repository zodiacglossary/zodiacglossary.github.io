import{j as e,L as B}from"./LemmaLink.2EoHCBTv.js";import{r as d}from"./index.Cd_vQiNd.js";const O={alphabetical:"original",alphabetical_transliteration:"transliteration",alphabetical_primary_meaning:"primary_meaning",zodiac:"primary_meaning",decans:"primary_meaning",planets_babylonian:"primary_meaning",planets_weekday:"primary_meaning",planets_heliocentric:"primary_meaning",planets_geocentric:"primary_meaning"},D={zodiac:["aries","taurus","gemini","cancer","leo","virgo","libra","scorpio","sagittarius","capricorn","aquarius","pisces"],planets_babylonian:["moon","sun","jupiter","venus","saturn","mercury","mars"],planets_weekday:["sun","moon","mars","mercury","jupiter","venus","saturn"],planets_heliocentric:["mercury","venus","earth","mars","jupiter","saturn","uranus","neptune"],planets_geocentric:["moon","mercury","venus","sun","mars","jupiter","saturn"],decans:Array.from({length:36},(o,j)=>`decan ${j+1}`)};function Q(o){return(j,c)=>{for(const g of o){const l=g(j,c);if(l!==0)return l}return 0}}function J(){const[o,j]=d.useState(null),[c,g]=d.useState([{field:"original",value:""}]),[l,y]=d.useState([{type:"alphabetical"}]),[_,q]=d.useState([]),[S,F]=d.useState(!0),[w,N]=d.useState(!0);d.useEffect(()=>{fetch("/data.json").then(t=>t.json()).then(t=>j(t))},[]);const P=()=>g([...c,{field:"original",value:""}]),T=t=>g(c.filter((r,n)=>n!==t)),V=(t,r)=>{const n=[...c];n[t].field=r,n[t].value="",g(n)},L=(t,r)=>{const n=[...c];n[t].value=r,g(n)},A=()=>y([...l,{type:"alphabetical"}]),I=t=>y(l.filter((r,n)=>n!==t)),M=(t,r)=>{const n=[...l];n[t].type=r,y(n)},z=async()=>{const t={lemmaIds:_.map(p=>p.lemma_id),includeSpellingVariants:S,includeQuotations:w,searchTerms:[],sortingCriteria:[]},n=await(await fetch("https://zodiac-glossary-pdf.fly.dev/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).blob(),b=URL.createObjectURL(n);window.open(b,"_blank")};return d.useEffect(()=>{if(!o)return;const{lemmata:t,meanings:r,meaningCategories:n,quotations:b}=o,p=new Map;r.forEach(a=>{p.has(a.lemma_id)||p.set(a.lemma_id,[]),p.get(a.lemma_id).push(a)});const m=new Map;b.forEach(a=>{m.has(a.lemma_id)||m.set(a.lemma_id,[]),m.get(a.lemma_id).push(a)});const k={editor:[],language:[],pos:[],literal_translation:[],meaning:[],category:[],original:[],transliteration:[],publication:[],provenance:[],source:[]};c.forEach(a=>{a.value.trim()!==""&&k[a.field].push(a)});const R=t.filter(a=>Object.entries(k).every(([v,h])=>h.length===0?!0:h.some(({value:f})=>{const s=f.toLowerCase().trim();switch(v){case"editor":return a.editor?.toLowerCase().includes(s);case"original":return a.original?.toLowerCase().includes(s);case"transliteration":return a.transliteration?.toLowerCase().includes(s);case"literal_translation":return a.translation?.toLowerCase().includes(s);case"language":return a.language_id===Number(s);case"pos":return a.partofspeech_id===Number(s);case"publication":return(m.get(a.lemma_id)||[]).some(i=>i.publication?.toLowerCase().includes(s));case"meaning":return(p.get(a.lemma_id)||[]).some(i=>i.value?.toLowerCase().includes(s));case"category":return(p.get(a.lemma_id)||[]).some(i=>n.find(x=>x.meaning_id===i.meaning_id)?.category?.toLowerCase()===s);case"provenance":return(m.get(a.lemma_id)||[]).some(i=>i.provenance?.toLowerCase().includes(s));case"source":return(m.get(a.lemma_id)||[]).some(i=>i.source?.toLowerCase().includes(s));default:return!0}})));if(l.length){const a=l.map(v=>{const h=O[v.type],f=D[v.type];return f?(s,u)=>{const i=(s[h]||"").toLowerCase(),E=(u[h]||"").toLowerCase(),x=f.indexOf(i),C=f.indexOf(E);return x!==-1&&C!==-1?x-C:x!==-1?-1:C!==-1?1:0}:(s,u)=>(s[h]||"").localeCompare(u[h]||"")});R.sort(Q(a))}q(R)},[c,o,l]),o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{class:"grid",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Search criteria"}),e.jsx("form",{className:"search-rows",children:c.map((t,r)=>e.jsxs("fieldset",{role:"group",children:[e.jsxs("select",{value:t.field,onChange:n=>V(r,n.target.value),children:[e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"language",children:"Language"}),e.jsx("option",{value:"pos",children:"Part of Speech"}),e.jsx("option",{value:"literal_translation",children:"Literal Translation"}),e.jsx("option",{value:"meaning",children:"Meaning"}),e.jsx("option",{value:"category",children:"Category"}),e.jsx("option",{value:"original",children:"Original"}),e.jsx("option",{value:"transliteration",children:"Transliteration"}),e.jsx("option",{value:"publication",children:"Publication"}),e.jsx("option",{value:"provenance",children:"Provenance"}),e.jsx("option",{value:"source",children:"Source"})]}),["language","pos","category"].includes(t.field)?e.jsxs("select",{value:t.value,onChange:n=>L(r,n.target.value),children:[e.jsx("option",{value:"",children:"—"}),t.field==="language"&&o.languages.map(n=>e.jsx("option",{value:n.language_id,children:n.label},n.language_id)),t.field==="category"&&[...new Set(o.meaningCategories.map(n=>n?.category))].toSorted().map(n=>e.jsx("option",{value:n,children:n},n)),t.field==="pos"&&o.partsofspeech.map(n=>e.jsx("option",{value:n.partofspeech_id,children:n.value},n.partofspeech_id))]}):e.jsx("input",{type:"text",value:t.value,onChange:n=>L(r,n.target.value),placeholder:"Enter search term…"}),e.jsx("button",{onClick:()=>T(r),children:"✕"})]},r))}),e.jsx("button",{onClick:P,children:"+ Add Search Condition"})]}),e.jsxs("div",{children:[e.jsx("h3",{children:"Sorting"}),e.jsxs("form",{className:"sort-rows",children:[l.map((t,r)=>e.jsxs("fieldset",{role:"group",children:[e.jsx("select",{value:t.type,onChange:n=>M(r,n.target.value),children:Object.keys(O).map(n=>e.jsx("option",{value:n,children:n},n))}),e.jsx("button",{onClick:()=>I(r),children:"✕"})]},r)),e.jsx("button",{onClick:A,children:"+ Add Sort Criterion"})]})]})]}),e.jsx("hr",{}),e.jsxs("div",{class:"grid",children:[e.jsx("button",{onClick:z,children:"Generate PDF"}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:S,onChange:t=>F(t.target.checked)})," ","Include Spelling Variants"]})}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:w,onChange:t=>N(t.target.checked)})," ","Include Quotations"]})})]}),e.jsx("hr",{}),e.jsxs("article",{children:[e.jsxs("header",{children:["Results (",_.length,")"]}),e.jsx("ul",{className:"search-results",children:_.map(t=>e.jsx("li",{children:e.jsx(B,{lemma:t})},t.lemma_id))})]})]}):e.jsx("p",{"aria-busy":"true",children:"Loading…"})}export{J as default};
