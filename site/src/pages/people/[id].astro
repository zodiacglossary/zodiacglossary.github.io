---
import Layout from '../../components/Layout.astro';
import LemmaLink from '../../components/LemmaLink';
import data from '../../../public/data.json';

export async function getStaticPaths() {
  return data.users.map(user => ({ params: { id: user.id.toString() } }));
}

const userId = Astro.params.id;
const user = data.users.find(u => u.id.toString() === userId);
const entries = user
  ? data.lemmata.filter(l => l.editor.split(", ").includes(user.username))
  : [];

const jsonLD = user ? {
  "@context": "https://schema.org",
  "@type": "Person",
  name: `${user.first_name} ${user.last_name}`,
  email: user.email ? `mailto:${user.email}` : undefined,
  url: user.website || undefined,
  alternateName: user.username,
  contribution: [
    {
      "@type": "Role",
      roleName: "Contributor",
      contributionTo: { "@type": "Dataset", url: Astro.page }
    }
  ]
} : null;
---

<Layout title={`Entries by ${user ? `${user.first_name} ${user.last_name}` : 'Unknown'}`} jsonLD={jsonLD}>
  {user ? (
    <>
      <h1>{user.first_name} {user.last_name}</h1>
      <p>{user.email && <><strong>Email:</strong> <a href={`mailto:${user.email}`}>{user.email}</a></>}</p>
      <p>{user.website && <><strong>Website:</strong> <a href={user.website} target="_blank" rel="noopener noreferrer">{user.website}</a></>}</p>

      <h2>Edited Entries</h2>
      {entries.length === 0 ? (
        <p>No entries found.</p>
      ) : (
        <ul>
          {entries.map(l => (
            <li>
              <LemmaLink client:only="react" lemma={l} />
            </li>
          ))}
        </ul>
      )}
    </>
  ) : (
    <p>User not found.</p>
  )}
</Layout>
